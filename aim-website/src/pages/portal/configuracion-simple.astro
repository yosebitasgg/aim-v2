---
layout: ../../layouts/PortalLayoutSidebar.astro
title: Configuraci√≥n - Portal AIM
---

<div class="max-w-4xl mx-auto">
  <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
    <h2 class="text-2xl font-bold text-gray-900 mb-6">Configuraci√≥n Simplificada</h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Nombre Completo</label>
        <input 
          type="text" 
          id="user-name"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 font-medium"
          value="Cargando..."
          readonly
        />
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Correo Electr√≥nico</label>
        <input 
          type="email" 
          id="user-email"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 font-medium"
          value="Cargando..."
          readonly
        />
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">ID de Usuario</label>
        <input 
          type="text" 
          id="user-id"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 font-mono text-sm"
          value="Cargando..."
          readonly
        />
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Rol del Usuario</label>
        <input 
          type="text" 
          id="user-role"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-900 font-medium capitalize"
          value="Cargando..."
          readonly
        />
      </div>
    </div>
    
    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
      <h3 class="font-medium text-gray-900 mb-2">Debug Info:</h3>
      <div id="debug-info" class="text-sm text-gray-600">
        Cargando informaci√≥n de debug...
      </div>
    </div>
  </div>
</div>

<script>
  import { userStore } from '../../lib/userStore.js';

  console.log('üöÄ P√°gina de configuraci√≥n simplificada iniciando...');

  // Funci√≥n para actualizar los campos (simplificada)
  function updateFields(user) {
    console.log('üìù Actualizando campos con usuario:', user);
    
    if (!user) {
      console.warn('‚ö†Ô∏è Usuario es null o undefined');
      return;
    }

    // Actualizar campos de forma directa
    const nameEl = document.getElementById('user-name');
    const emailEl = document.getElementById('user-email');
    const idEl = document.getElementById('user-id');
    const roleEl = document.getElementById('user-role');
    const debugEl = document.getElementById('debug-info');
    
    if (nameEl) {
      nameEl.value = user.name || 'Sin nombre';
      console.log('‚úÖ Nombre actualizado:', nameEl.value);
    }
    
    if (emailEl) {
      emailEl.value = user.email || 'Sin email';
      console.log('‚úÖ Email actualizado:', emailEl.value);
    }
    
    if (idEl) {
      idEl.value = user.id || 'Sin ID';
      console.log('‚úÖ ID actualizado:', idEl.value);
    }
    
    if (roleEl) {
      roleEl.value = user.role || 'user';
      console.log('‚úÖ Rol actualizado:', roleEl.value);
    }
    
    if (debugEl) {
      debugEl.innerHTML = `
        <strong>‚úÖ Usuario cargado exitosamente:</strong><br>
        <pre style="white-space: pre-wrap; font-size: 12px; background: #f0f9f0; padding: 8px; border-radius: 4px;">${JSON.stringify(user, null, 2)}</pre>
      `;
    }
  }

  // Funci√≥n para mostrar error (simplificada)
  function showError(error) {
    console.error('‚ùå Error en p√°gina de configuraci√≥n:', error);
    
    const debugEl = document.getElementById('debug-info');
    if (debugEl) {
      debugEl.innerHTML = `
        <strong>‚ùå Error:</strong><br>
        <span style="color: red;">${error.message}</span>
      `;
    }
  }

  // Inicializaci√≥n simplificada (igual que el header)
  document.addEventListener('DOMContentLoaded', async () => {
    console.log('üì° Inicializando p√°gina de configuraci√≥n (patr√≥n del header)...');
    
    try {
      // Usar el mismo patr√≥n exacto que el header
      const user = await userStore.loadUser();
      
      if (user && user.name) {
        console.log('‚úÖ Usuario encontrado, actualizando campos:', user.name);
        updateFields(user);
      } else {
        console.log('‚ùå No se pudo cargar usuario');
        showError(new Error('No se pudo cargar la informaci√≥n del usuario'));
      }
      
    } catch (error) {
      console.error('‚ùå Error cargando usuario:', error);
      showError(error);
    }

    // Suscribirse a cambios del userStore (igual que el header)
    userStore.subscribe((state) => {
      console.log('üì° Cambio en userStore:', state);
      if (state.user && state.user.name) {
        console.log('‚úÖ Actualizando desde suscripci√≥n:', state.user.name);
        updateFields(state.user);
      }
    });
  });
</script> 